# 头像上传功能说明

## 功能概述

用户可以在个人资料页面点击头像来上传和更换头像图片。

## 前端实现

### 组件结构

1. **ProfileAvatar组件** (`app/user/profile/ProfileAvatar.tsx`)
   - 显示用户当前头像
   - 提供点击上传功能
   - 包含上传弹窗和预览功能

2. **主要功能**
   - 点击头像显示上传弹窗
   - 文件选择和验证（类型、大小）
   - 实时预览选择的图片
   - 上传进度显示
   - 上传成功后自动更新头像

### 技术特性

- **文件验证**: 仅支持图片格式，最大5MB
- **实时预览**: 选择文件后立即显示预览
- **响应式设计**: 适配桌面和移动设备
- **用户体验**: 悬停效果、加载状态、错误提示

## 后端实现

### API端点

**POST** `/api/profile/avatar`

### 功能特性

1. **用户认证**: 验证用户登录状态
2. **文件验证**: 检查文件类型和大小
3. **安全存储**: 生成唯一文件名，防止冲突
4. **数据库更新**: 自动更新用户头像URL
5. **错误处理**: 完整的错误处理和用户反馈

### 存储结构

```
public/
  uploads/
    avatars/
      [uuid].[ext]  # 实际头像文件
      .gitkeep      # 确保目录存在
```

## 使用方法

1. 登录用户访问个人资料页面 (`/user/profile`)
2. 点击头像区域
3. 在弹出的对话框中点击"选择图片"
4. 选择符合要求的图片文件
5. 预览确认后点击"确认上传"
6. 等待上传完成，头像自动更新

## 文件限制

- **支持格式**: JPG, PNG, GIF
- **文件大小**: 最大 5MB
- **存储位置**: `public/uploads/avatars/`

## 安全考虑

- 用户认证验证
- 文件类型严格检查
- 文件大小限制
- 唯一文件名生成
- 上传目录权限控制

## 后续优化建议

1. **图片处理**: 添加图片压缩和尺寸调整
2. **CDN集成**: 考虑使用云存储服务
3. **缓存优化**: 添加图片缓存策略
4. **批量上传**: 支持多张图片上传
5. **图片编辑**: 添加裁剪、旋转等编辑功能 